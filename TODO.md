# Refactor Plan & Progress

_Last updated: 2025-10-06 (post useSeatHandlers extraction)_

## Completed (Phase 2)

- Extracted tooltip layout logic → `tooltipLayout.ts`
- Extracted seat interaction logic → `seatInteractions.ts`
- Extracted seat ARIA/title builder → `seatAria.ts`
- Split tooltip rendering into `TooltipContent` inside `HemicycleTooltip.tsx`
- Reverted unrelated formatting changes prior to commit
- Commit: `d6394c3 refactor(parliament): extract tooltip layout and seat interaction utilities`

## Current State

Lint now flags only warnings for size/complexity in multiple components. No new type errors.

## Pending / Next Decisions

- **plan-next-phase**: Choose next focus area for complexity reduction.

## Candidate Next Refactors

### A. Seat / Seat Interactions

- (DONE) Extract `useSeatHandlers` hook (keyboard + hover/lock logic) → `useSeatHandlers.ts`
- (DONE) Split `Seat` visual circles into `SeatCircles` SVG micro-component

### B. Tooltip Decomposition

- Move color constants + sizing tokens to `tooltipLayout.ts` or a `tooltipTheme.ts`
- Split secondary info/text block into its own component for line count reduction

### C. HemicycleReact Simplification

- (DONE) Separate state orchestration vs render container (`HemicycleReact` -> `HemicycleView`)
- (DONE) Extract export logic via `useHemicycleExport` hook

### D. FiltersPanel Modularization

- (DONE) Extract `FilterBadge` & `FilterSection`
- (DONE) Extract `PartyFilterList` and `GenderFilterList`
- (DONE) Add `ActiveFiltersSummary` with memoized derivations
- (DONE) Centralize per-filter option computation inside dedicated list components
- Potential: further extract AgeRange inputs if complexity grows

### E. useHemicycleLayout Heavy Function

- Split geometry calculations (rings, seat placement) into pure utilities in `d3.ts` or
  `layout/geometry.ts`
- Keep hook focused on memo orchestration + dependency wiring

### F. SnapshotExplorer / Filters / Legend

- Decompose long render blocks into smaller presentational components (pure props)

## Prioritization Guidance

1. Target components users interact with most (HemicycleReact + FiltersPanel)
2. Reduce cognitive load in hooks with >150 LOC (`useHemicycleLayout`)
3. Only further split tooltip/seat if still noisy after larger structural wins

## Definition of Done for Each Refactor

- Lint: removed or reduced max-lines / complexity warnings where practical
- No behavior changes (visual or a11y) without explicit intent
- Naming matches existing patterns; no broad stylistic churn

## Deferred (Not in Scope Yet)

- Test suite scaffolding (unit + interaction)
- Performance optimization (memo boundaries audit)
- Theming abstraction for tooltip + legend

## Suggested Next Step

Pick one: `A` (Seat handlers), `C` (HemicycleReact), or `D` (FiltersPanel) based on desired
user-facing impact.

---

(Generated by assistant; edit freely as plan evolves.)
